{{- if .Publish}}
{{- range $topic := .Publish.Topics}}
{{.Name}}SNSTopic:
    Type: AWS::SNS::Topic
    Properties:
      TopicName: !Join ['', [!Ref AppName, '-', !Ref EnvName, '-', {{.Name}}]]
      
  {{.Name}}SNSTopicPolicy:
    Type: AWS::SNS::TopicPolicy
    DependsOn: {{.Name}}SNSTopic
    Properties:
      Topics: 
        - !Ref ${AWS::StackName}-{{.Name}}-SNSTopic
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          {{- range $worker := .AllowedWorkers}}
          - Effect: Allow
            Principal:
              Service: sqs.amazonaws.com
            Action: 
              - sns:Subscribe
            Resource: !Sub 'arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:*'
            Condition:
              StringEquals:
                'sqs:ResourceTag/copilot-application': !Sub '${AppName}'
                'sqs:ResourceTag/copilot-environment': !Sub '${EnvName}'
                'sqs:ResourceTag/copilot-service': !Sub {{$worker}}
          {{- end}}
{{- end}}
{{- end}}